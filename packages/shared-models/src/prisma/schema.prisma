datasource db {
  provider = "mongodb"
  url      = env("MONGODB_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserStatus {
  INACTIVE
  ACTIVE
}

enum MemberRole {
  GUEST
  MEMBER
  MANAGER
  LEADER
}

enum OrganizationRole {
  ADMIN
  MEMBER
}

enum InvitationStatus {
  REJECTED
  ACCEPTED
  INVITING
}

enum TaskPriority {
  URGENT
  HIGH
  NORMAL
  LOW
}

enum StatusType {
  DONE
  INPROCESS
  TODO
}

model User {
  id                  String                @id @default(auto()) @map("_id") @db.ObjectId
  email               String                @unique
  password            String
  name                String?
  status              UserStatus?
  country             String?
  bio                 String?
  photo               String?
  dob                 DateTime?
  members             Members[]
  organizationMembers OrganizationMembers[]
  createdAt           DateTime?
  createdBy           String?
  updatedAt           DateTime?
  updatedBy           String?
}

model Favorites {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  icon      String
  link      String
  uid       String    @db.ObjectId
  orgId     String    @db.ObjectId
  type      String
  createdAt DateTime?
  createdBy String?
  updatedAt DateTime?
  updatedBy String?
}

model Organization {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String    @unique
  cover     String?
  avatar    String?
  desc      String?
  createdAt DateTime?
  createdBy String?
  updatedAt DateTime?
  updatedBy String?
}

model OrganizationMembers {
  id             String           @id @default(auto()) @map("_id") @db.ObjectId
  uid            String           @db.ObjectId
  status         InvitationStatus
  organizationId String           @db.ObjectId
  role           OrganizationRole
  users          User             @relation(fields: [uid], references: [id])
  createdAt      DateTime?
  createdBy      String?
  updatedAt      DateTime?
  updatedBy      String?
}

model Task {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  desc         String?
  dueDate      DateTime?
  startDate    DateTime?
  projectId    String        @db.ObjectId
  priority     TaskPriority?
  taskStatusId String?       @db.ObjectId
  tagIds       String[]      @db.ObjectId
  assigneeIds  String[]      @db.ObjectId
  fileIds      String[]      @db.ObjectId
  parentTaskId String?       @db.ObjectId
  progress     Int?
  done         Boolean       @default(false)
  // do not store `point` as objectID, cuz we just need to fill the point value
  taskPoint    Int?

  createdBy String?
  createdAt DateTime?
  updatedBy String?
  updatedAt DateTime?
}

model TaskStatus {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  color     String
  order     Int
  projectId String     @db.ObjectId
  type      StatusType @default(TODO)
}

// Tag used for Projects and Tasks
model Tag {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  color     String
  projectId String @db.ObjectId
}

model TaskPoint {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  point     Int
  projectId String  @db.ObjectId
  icon      String?
}

type taskAutomateThenType {
  change String
  value  String
}

type taskAutomateWhenType {
  happens   String
  is        String
  valueFrom String?
  valueTo   String?
  equal     String?
}

model TaskAutomation {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  organizationId String    @db.ObjectId
  projectId      String    @db.ObjectId
  when           Json
  then           Json
  createdBy      String?
  createdAt      DateTime?
  updatedBy      String?
  updatedAt      DateTime?
}

enum FileType {
  FILE
  FOLDER
}

enum FileOwnerType {
  TASK
  DISCUSSION
  DOCUMENT
}

model FileStorage {
  id             String         @id @default(auto()) @map("_id") @db.ObjectId
  organizationId String         @db.ObjectId
  projectId      String         @db.ObjectId
  name           String
  keyName        String
  type           FileType
  url            String?
  size           Float?
  mimeType       String?
  parentId       String?
  owner          String?        @db.ObjectId
  ownerType      FileOwnerType?
  isDeleted      Boolean?       @default(false)
  createdBy      String?
  createdAt      DateTime?
  deletedAt      DateTime?
  deletedBy      String?
}

model Project {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  desc           String?
  cover          String?
  icon           String?
  createdBy      String?
  createdAt      DateTime?
  organizationId String
  updatedBy      String?
  updatedAt      DateTime?
}

model Members {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  projectId String     @db.ObjectId
  role      MemberRole
  users     User?      @relation(fields: [uid], references: [id])
  uid       String?    @db.ObjectId
  createdBy String?
  createdAt DateTime?
  updatedBy String?
  updatedAt DateTime?
}

enum DashboardComponentType {
  LINE
  SUMMARY
  PIE
  LISTTAB
  LIST
  COLUMN
}

model DashboardComponent {
  id          String                  @id @default(auto()) @map("_id") @db.ObjectId
  dashboard   Dashboard?              @relation(fields: [dashboardId], references: [id])
  dashboardId String?                 @db.ObjectId
  title       String?
  type        DashboardComponentType?
  config      Json?

  createdBy String?
  createdAt DateTime?
  updatedBy String?
  updatedAt DateTime?
}

model Dashboard {
  id                  String               @id @default(auto()) @map("_id") @db.ObjectId
  dashboardComponents DashboardComponent[]
  title               String?              @default("Untitled")
  projectId           String?              @db.ObjectId
  isDefault           Boolean?             @default(false)
}
